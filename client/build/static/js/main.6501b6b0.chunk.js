(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{46:function(e,t,n){},53:function(e,t,n){},54:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),s=n(12),c=n.n(s),i=n(10),o=n(17),l="LOGIN_SUCCESS",u="LOGOUT_OPTIMISTIC",p="BEGIN_API_CALL",h="API_CALL_ERROR",b={loggedIn:!1,userData:null,apiCallsInProgress:0};function j(e){return"_SUCCESS"===e.substring(e.length-8)}var d=Object(o.b)({loggedIn:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b.loggedIn,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case l:return!0;case u:return!1;default:return e}},userData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b.userData,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case l:return t.user;case u:return null;default:return e}},apiCallsInProgress:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b.apiCallsInProgress,t=arguments.length>1?arguments[1]:void 0;return t.type===p?e+1:t.type===h||j(t.type)?e-1:e}}),m=n(26),g=n.n(m),f=n(27);var O=n(14),x=n(3),v=n(19),w=n(4),N=n.n(w),k=n(6);function I(e){return C.apply(this,arguments)}function C(){return(C=Object(k.a)(N.a.mark((function e(t){var n,r,a,s,c,i=arguments;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:"GET",r=i.length>2&&void 0!==i[2]?i[2]:null,a=i.length>3&&void 0!==i[3]?i[3]:{},e.prev=3,r&&(r=JSON.stringify(r),a["Content-type"]="application/json"),e.next=7,fetch(t,{method:n,body:r,headers:a});case 7:return s=e.sent,e.next=10,s.json();case 10:return(c=e.sent).ok=s.ok,e.abrupt("return",c);case 15:throw e.prev=15,e.t0=e.catch(3),new Error(e.t0.message," \u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a.");case 18:case"end":return e.stop()}}),e,null,[[3,15]])})))).apply(this,arguments)}var y=function(){var e=Object(k.a)(N.a.mark((function e(t){var n;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,I("/api/auth/signup","POST",t);case 3:return n=e.sent,e.abrupt("return",n);case 7:e.prev=7,e.t0=e.catch(0),console.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 ".concat(e.t0.message));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),S=function(){var e=Object(k.a)(N.a.mark((function e(t){var n;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,I("/api/auth/login","POST",t);case 3:if(!((n=e.sent).token&&n.userId&&n.ok)){e.next=7;break}return localStorage.setItem("userData",JSON.stringify({userId:n.userId,token:n.token})),e.abrupt("return",n);case 7:return e.abrupt("return",n);case 10:e.prev=10,e.t0=e.catch(0),console.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043f\u043e\u043f\u044b\u0442\u043a\u0435 \u0432\u0445\u043e\u0434\u0430 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443 ".concat(e.t0.message));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}();function _(){return{type:p}}function E(){return{type:h}}function A(e){return P.apply(this,arguments)}function P(){return(P=Object(k.a)(N.a.mark((function e(t){var n;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,I("/api/profile","GET",null,{Authorization:"Bearer ".concat(t)});case 3:if(!(n=e.sent).ok){e.next=8;break}return e.abrupt("return",n);case 8:throw Error("\u0412\u044b \u043d\u0435 \u0430\u0432\u0442\u043e\u0438\u0437\u043e\u0432\u0430\u043d\u044b. \u0412\u043e\u0439\u0434\u0438\u0442\u0435 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443");case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}function D(e){return{type:"SIGNUP_SUCCESS",data:e}}function T(e){return{type:l,user:e}}function L(e){return{type:"CHECKAUTH_SUCCESS",userData:e}}function R(){return function(e){return localStorage.removeItem("userData"),e({type:u})}}var U=n.p+"static/media/admin-img.54866eab.png",G=n.p+"static/media/user-img.e582e4ba.png",F=(n(46),n(1)),J=function(){return Object(F.jsx)("div",{className:"loader",children:"Loading..."})};var q={logoutAction:R,checkAuthAction:function(e){return function(){var t=Object(k.a)(N.a.mark((function t(n){var r;return N.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n(_()),t.next=3,A(e);case 3:if(!(r=t.sent)){t.next=8;break}return t.abrupt("return",n(L(r)));case 8:throw Error("\u0412\u044b \u043d\u0435 \u0430\u0432\u0442\u043e\u0438\u0437\u043e\u0432\u0430\u043d\u044b. \u0412\u043e\u0439\u0434\u0438\u0442\u0435 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443");case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}},B=Object(i.b)((function(e){return{token:e.userData.token,loggedIn:e.loggedIn,loading:e.apiCallsInProgress>0}}),q)((function(e){var t=Object(r.useState)({}),n=Object(v.a)(t,2),a=n[0],s=n[1];return Object(r.useEffect)((function(){e.checkAuthAction(e.token).then((function(t){t.userData.ok||e.logoutAction(),s(t.userData)})).catch((function(e){console.error(e.message)}))}),[]),Object(F.jsx)(F.Fragment,{children:e.loading?Object(F.jsx)(J,{}):Object(F.jsxs)("div",{className:"profile-container",children:[Object(F.jsx)("h1",{children:"\u041b\u0438\u0447\u043d\u044b\u0439 \u043a\u0430\u0431\u0438\u043d\u0435\u0442"}),Object(F.jsxs)("div",{className:"profile-container__text-container",children:[Object(F.jsx)("h2",{className:"profile-container__subtitle",children:"\u0412\u0430\u0448\u0438 \u0434\u0430\u043d\u043d\u044b\u0435"}),Object(F.jsxs)("ul",{className:"profile-container__list",children:[Object(F.jsx)("li",{children:Object(F.jsxs)("span",{children:["\u0418\u043c\u044f: ",a.firstName]})}),Object(F.jsxs)("li",{children:["\u0424\u0430\u043c\u0438\u043b\u0438\u044f: ",a.lastName]}),Object(F.jsxs)("li",{children:["Email: ",a.email]})]})]}),a.isAdmin?Object(F.jsx)("div",{className:"img-wrapper",children:Object(F.jsx)("img",{className:"img-wrapper__img",src:U,alt:"\u041a\u0430\u0440\u0442\u0438\u043d\u043a\u0430 \u0430\u0434\u043c\u0438\u043d\u0430"})}):Object(F.jsx)("div",{className:"img-wrapper",children:Object(F.jsx)("img",{className:"img-wrapper__img",src:G,alt:"\u041a\u0430\u0440\u0442\u0438\u043d\u043a\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f"})})]})})})),H=n(15),M=n(22),X=n(11);var z={loginAction:function(e){return function(){var t=Object(k.a)(N.a.mark((function t(n){var r,a;return N.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n(_()),t.next=4,S(e);case 4:if(!(r=t.sent).ok){t.next=9;break}return t.abrupt("return",n(T(r)));case 9:if(!r.errors){t.next=14;break}throw a=r.errors.map((function(e){return e.msg})),new Error(a.join(", "));case 14:throw new Error(r.message);case 15:t.next=21;break;case 17:throw t.prev=17,t.t0=t.catch(0),n(E()),new Error(t.t0.message);case 21:case"end":return t.stop()}}),t,null,[[0,17]])})));return function(e){return t.apply(this,arguments)}}()}},K=Object(i.b)((function(e){return{loading:e.apiCallsInProgress>0}}),z)((function(e){var t=Object(r.useState)({email:"",password:""}),n=Object(v.a)(t,2),a=n[0],s=n[1];function c(e){var t=e.target.value,n=e.target.name;s(Object(M.a)(Object(M.a)({},a),{},Object(H.a)({},n,t)))}return Object(F.jsx)(F.Fragment,{children:e.loading?Object(F.jsx)(J,{}):Object(F.jsxs)("div",{className:"wrapper",children:[Object(F.jsx)("h1",{className:"page-title",children:"\u0412\u043e\u0439\u0442\u0438"}),Object(F.jsxs)("form",{className:"form form_login",onSubmit:function(t){t.preventDefault(),e.loginAction(a).then((function(e){if(e.user.ok)return X.b.success(e.user.message)})).catch((function(e){console.error(e.message),e.message.split(", ").forEach((function(e){return X.b.error(e)}))})).finally((function(){return s({email:"",password:""})}))},children:[Object(F.jsxs)("label",{className:"label",children:["Email",Object(F.jsx)("input",{className:"input",name:"email",type:"email",onChange:c})]}),Object(F.jsxs)("label",{className:"label",children:["\u041f\u0430\u0440\u043e\u043b\u044c",Object(F.jsx)("input",{className:"input",name:"password",type:"password",onChange:c})]}),Object(F.jsx)("button",{type:"submit",className:"btn",children:"\u0412\u043e\u0439\u0442\u0438"})]})]})})})),V=n(28),Q=n(29),W=n(16),Y=n(31),Z=n(30),$=function(e){Object(Y.a)(n,e);var t=Object(Z.a)(n);function n(e){var r;return Object(V.a)(this,n),(r=t.call(this,e)).state={firstName:"",lastName:"",email:"",password:"",repeatPassword:"",role:"user",isAdmin:!1},r.handleInputChange=r.handleInputChange.bind(Object(W.a)(r)),r.handleSelect=r.handleSelect.bind(Object(W.a)(r)),r.sendReq=r.sendReq.bind(Object(W.a)(r)),r}return Object(Q.a)(n,[{key:"handleInputChange",value:function(e){var t=e.target.value,n=e.target.name;this.setState(Object(H.a)({},n,t))}},{key:"handleSelect",value:function(e){this.setState({role:e.target.value}),this.setState({isAdmin:"admin"===e.target.value})}},{key:"sendReq",value:function(){var e=Object(k.a)(N.a.mark((function e(t){var n,r,a,s,c,i,o;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),this.state.password===this.state.repeatPassword){e.next=3;break}return e.abrupt("return",X.b.error("\u041f\u0430\u0440\u043e\u043b\u0438 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442."));case 3:return n=this.state,r=n.firstName,a=n.lastName,s=n.email,c=n.password,i=n.isAdmin,e.prev=4,e.next=7,this.props.signupAction({firstName:r,lastName:a,email:s,password:c,isAdmin:i});case 7:(o=e.sent).data.ok&&(X.b.success(o.data.message),this.props.history.push("/login")),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(4),console.error(e.t0.message),e.t0.message.split(", ").forEach((function(e){return X.b.error(e)}));case 15:return e.prev=15,this.setState({firstName:"",lastName:"",email:"",password:"",repeatPassword:"",role:"user",isAdmin:!1}),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[4,11,15,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){return Object(F.jsx)(F.Fragment,{children:this.props.loading?Object(F.jsx)(J,{}):Object(F.jsxs)("div",{className:"wrapper",children:[Object(F.jsx)("h1",{className:"page-title",children:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"}),Object(F.jsxs)("form",{className:"form",onSubmit:this.sendReq,children:[Object(F.jsxs)("label",{className:"label",children:["\u0418\u043c\u044f",Object(F.jsx)("input",{className:"input",name:"firstName",type:"text",onChange:this.handleInputChange})]}),Object(F.jsxs)("label",{className:"label",children:["\u0424\u0430\u043c\u0438\u043b\u0438\u044f",Object(F.jsx)("input",{className:"input",name:"lastName",type:"text",onChange:this.handleInputChange})]}),Object(F.jsxs)("label",{className:"label",children:["Email",Object(F.jsx)("input",{className:"input",name:"email",type:"email",onChange:this.handleInputChange})]}),Object(F.jsxs)("label",{className:"label",children:["\u041f\u0430\u0440\u043e\u043b\u044c",Object(F.jsx)("input",{className:"input",name:"password",type:"password",onChange:this.handleInputChange})]}),Object(F.jsxs)("label",{className:"label",children:["\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c",Object(F.jsx)("input",{className:"input",name:"repeatPassword",type:"password",onChange:this.handleInputChange})]}),Object(F.jsxs)("label",{className:"label",children:["\u0417\u0430\u0440\u0435\u0433\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u043a\u0430\u043a:",Object(F.jsxs)("select",{className:"input",value:this.state.role,onChange:this.handleSelect,children:[Object(F.jsx)("option",{value:"user",children:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c"}),Object(F.jsx)("option",{value:"admin",children:"\u0410\u0434\u043c\u0438\u043d"})]})]}),Object(F.jsx)("button",{type:"submit",className:"btn",children:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"}),Object(F.jsxs)("p",{className:"form__paragraph",children:["\u0423\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b?",Object(F.jsxs)(O.b,{className:"form__link",to:"login",children:[" ","\u0412\u043e\u0439\u0434\u0438\u0442\u0435 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443"]})]})]})]})})}}]),n}(a.a.Component);var ee={signupAction:function(e){return function(){var t=Object(k.a)(N.a.mark((function t(n){var r,a;return N.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n(_()),t.next=4,y(e);case 4:if(!(r=t.sent).ok){t.next=9;break}return t.abrupt("return",n(D(r)));case 9:if(!r.errors){t.next=14;break}throw a=r.errors.map((function(e){return e.msg})),new Error(a.join(", "));case 14:throw new Error(r.message);case 15:t.next=21;break;case 17:throw t.prev=17,t.t0=t.catch(0),n(E()),new Error(t.t0.message);case 21:case"end":return t.stop()}}),t,null,[[0,17]])})));return function(e){return t.apply(this,arguments)}}()}},te=Object(i.b)((function(e){return{loading:e.apiCallsInProgress>0}}),ee)(Object(x.g)($));var ne=function(e){return Object(F.jsx)("header",{className:"header",children:e.loggedInFlag&&Object(F.jsx)("button",{onClick:e.handleClick,className:"btn",children:"\u0412\u044b\u0439\u0442\u0438"})})};n(52);var re={logoutAction:R},ae=Object(i.b)((function(e){return{loggedIn:e.loggedIn}}),re)((function(e){var t=e.loggedIn?Object(F.jsxs)(x.d,{children:[Object(F.jsx)(x.b,{path:"/profile",exact:!0,children:Object(F.jsx)(B,{})}),Object(F.jsx)(x.a,{to:"/profile"})]}):Object(F.jsxs)(x.d,{children:[Object(F.jsx)(x.b,{path:"/login",exact:!0,children:Object(F.jsx)(K,{})}),Object(F.jsx)(x.b,{path:"/signup",exact:!0,children:Object(F.jsx)(te,{})}),Object(F.jsx)(x.a,{to:"signup"})]});return Object(F.jsxs)("div",{className:"main",children:[Object(F.jsx)(ne,{loggedInFlag:e.loggedIn,handleClick:e.logoutAction}),Object(F.jsx)(O.a,{children:t}),Object(F.jsx)(X.a,{autoClose:3e3,hideProgressBar:!0})]})})),se=(n(53),JSON.parse(localStorage.getItem("userData"))),ce=function(e){var t=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||o.c;return Object(o.d)(d,e,t(Object(o.a)(f.a,g()())))}(se?{loggedIn:!0,userData:se,apiCallsInProgress:0}:{loggedIn:!1,userData:null,apiCallsInProgress:0});c.a.render(Object(F.jsx)(i.a,{store:ce,children:Object(F.jsx)(ae,{})}),document.getElementById("root"))}},[[54,1,2]]]);
//# sourceMappingURL=main.6501b6b0.chunk.js.map